import streamlit as st
import datetime
import pandas as pd

# --- 1. ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö (Page Config) ---
st.set_page_config(
    page_title="‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ó‡∏µ‡πà‡∏î‡∏¥‡∏ô‡πÅ‡∏•‡∏∞‡∏™‡∏¥‡πà‡∏á‡∏õ‡∏•‡∏π‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á",
    page_icon="üè°",
    layout="centered"  # ‡∏õ‡∏£‡∏±‡∏ö‡πÄ‡∏õ‡πá‡∏ô centered ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏≠‡πà‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÅ‡∏≠‡∏õ‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠
)

# --- 2. ‡πÅ‡∏ï‡πà‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡∏≤‡∏î‡πâ‡∏ß‡∏¢ CSS (Custom CSS) ---
st.markdown("""
    <style>
    .main {
        background-color: #f8f9fa;
    }
    .stMetric {
        background-color: #ffffff;
        padding: 15px;
        border-radius: 10px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    }
    h1, h2, h3 {
        color: #2c3e50;
    }
    .big-total {
        font-size: 24px;
        color: #16a085;
        font-weight: bold;
    }
    </style>
    """, unsafe_allow_html=True)

# --- 3. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì (Logic ‡πÄ‡∏î‡∏¥‡∏°: ‡∏ï‡∏≤‡∏°‡∏£‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ö ‡∏û.‡∏®. 2535) ---
def calculate_depreciation(build_type, age):
    if age < 1: age = 1
    dep_percent = 0
    
    if build_type == '‡∏ï‡∏∂‡∏Å (Concrete)':
        if age <= 10: dep_percent = age * 1
        else: dep_percent = 10 + (age - 10) * 2
        if dep_percent > 76: dep_percent = 76

    elif build_type == '‡∏Ñ‡∏£‡∏∂‡πà‡∏á‡∏ï‡∏∂‡∏Å‡∏Ñ‡∏£‡∏∂‡πà‡∏á‡πÑ‡∏°‡πâ (Half)':
        if age <= 5: dep_percent = age * 2
        elif age <= 15: dep_percent = 10 + (age - 5) * 4
        else: dep_percent = 10 + 40 + (age - 15) * 5
        if dep_percent > 85: dep_percent = 85

    elif build_type == '‡πÑ‡∏°‡πâ (Wood)':
        if age <= 5: dep_percent = age * 3
        elif age <= 15: dep_percent = 15 + (age - 5) * 5
        else: dep_percent = 15 + 50 + (age - 15) * 7
        if dep_percent > 93: dep_percent = 93
        
    return dep_percent

# --- 4. ‡∏™‡πà‡∏ß‡∏ô‡∏´‡∏±‡∏ß‡∏Ç‡∏≠‡∏á‡πÅ‡∏≠‡∏õ ---
st.title("üè° ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏£‡∏≤‡∏Ñ‡∏≤‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô")
st.caption("‡∏ä‡πà‡∏ß‡∏¢‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏£‡∏≤‡∏Ñ‡∏≤‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏î‡∏¥‡∏ô‡πÅ‡∏•‡∏∞‡∏™‡∏¥‡πà‡∏á‡∏õ‡∏•‡∏π‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á ‡∏ï‡∏≤‡∏°‡∏´‡∏•‡∏±‡∏Å‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏Å‡∏£‡∏°‡∏ò‡∏ô‡∏≤‡∏£‡∏±‡∏Å‡∏©‡πå (‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏™‡∏∑‡πà‡∏≠‡∏°‡∏õ‡∏µ 2535)")

# ‡∏™‡∏£‡πâ‡∏≤‡∏á Tabs ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏¢‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Å‡∏£‡∏≠‡∏Å‡∏á‡πà‡∏≤‡∏¢‡πÜ ‡πÑ‡∏°‡πà‡∏•‡∏≤‡∏¢‡∏ï‡∏≤
tab1, tab2, tab3 = st.tabs(["1. ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏î‡∏¥‡∏ô üå≥", "2. ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏¥‡πà‡∏á‡∏õ‡∏•‡∏π‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á üè†", "3. ‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏• üìä"])

# ==========================================
# TAB 1: ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏î‡∏¥‡∏ô
# ==========================================
with tab1:
    st.header("‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏õ‡∏•‡∏á‡∏ó‡∏µ‡πà‡∏î‡∏¥‡∏ô")
    
    col1, col2, col3 = st.columns(3)
    with col1:
        land_rai = st.number_input("‡πÑ‡∏£‡πà", min_value=0, value=0)
    with col2:
        land_ngan = st.number_input("‡∏á‡∏≤‡∏ô", min_value=0, value=0)
    with col3:
        land_wah = st.number_input("‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ß‡∏≤", min_value=0.0, value=17.0, step=0.1)

    # ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ß‡∏≤‡πÉ‡∏´‡πâ‡∏î‡∏π‡∏™‡∏î‡πÜ
    total_wah_calc = (land_rai * 400) + (land_ngan * 100) + land_wah
    st.info(f"üìç ‡∏£‡∏ß‡∏°‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏ó‡∏µ‡πà‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: **{total_wah_calc:,.1f}** ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ß‡∏≤")

    st.markdown("---")
    land_price_per_wah = st.number_input(
        "‡∏£‡∏≤‡∏Ñ‡∏≤‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏ï‡πà‡∏≠‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ß‡∏≤ (‡∏ö‡∏≤‡∏ó)", 
        min_value=0.0, 
        value=24000.0, 
        step=500.0,
        help="‡∏î‡∏π‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å‡πÄ‡∏ß‡πá‡∏ö‡∏Å‡∏£‡∏°‡∏ò‡∏ô‡∏≤‡∏£‡∏±‡∏Å‡∏©‡πå ‡∏´‡∏£‡∏∑‡∏≠‡πÇ‡∏â‡∏ô‡∏î‡∏ó‡∏µ‡πà‡∏î‡∏¥‡∏ô"
    )

# ==========================================
# TAB 2: ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏¥‡πà‡∏á‡∏õ‡∏•‡∏π‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á
# ==========================================
with tab2:
    st.header("‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏∑‡∏≠‡∏ô/‡∏™‡∏¥‡πà‡∏á‡∏õ‡∏•‡∏π‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á")
    
    build_type = st.selectbox(
        "‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏™‡∏¥‡πà‡∏á‡∏õ‡∏•‡∏π‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á", 
        ['‡∏ï‡∏∂‡∏Å (Concrete)', '‡∏Ñ‡∏£‡∏∂‡πà‡∏á‡∏ï‡∏∂‡∏Å‡∏Ñ‡∏£‡∏∂‡πà‡∏á‡πÑ‡∏°‡πâ (Half)', '‡πÑ‡∏°‡πâ (Wood)'],
        help="‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ß‡∏±‡∏™‡∏î‡∏∏‡∏´‡∏•‡∏±‡∏Å‡∏Ç‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡∏ö‡πâ‡∏≤‡∏ô"
    )

    current_year_sys = datetime.datetime.now().year + 543
    
    col_b1, col_b2 = st.columns(2)
    with col_b1:
        build_year_th = st.number_input("‡∏õ‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏™‡∏£‡πá‡∏à (‡∏û.‡∏®.)", min_value=2450, max_value=current_year_sys, value=2553)
    with col_b2:
        calc_year_th = st.number_input("‡∏õ‡∏µ‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏†‡∏≤‡∏©‡∏µ (‡∏û.‡∏®.)", min_value=2500, value=2565)

    col_b3, col_b4 = st.columns(2)
    with col_b3:
        build_area = st.number_input("‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏™‡∏≠‡∏¢ (‡∏ï‡∏£.‡∏°.)", min_value=0.0, value=120.0, help="‡∏Å‡∏ß‡πâ‡∏≤‡∏á x ‡∏¢‡∏≤‡∏ß ‡∏Ç‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£‡∏£‡∏ß‡∏°‡∏ó‡∏∏‡∏Å‡∏ä‡∏±‡πâ‡∏ô")
    with col_b4:
        build_price_sqm = st.number_input("‡∏£‡∏≤‡∏Ñ‡∏≤‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏Å‡∏•‡∏≤‡∏á (‡∏ö‡∏≤‡∏ó/‡∏ï‡∏£.‡∏°.)", min_value=0.0, value=10400.0, help="‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ï‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏Å‡∏£‡∏°‡∏ò‡∏ô‡∏≤‡∏£‡∏±‡∏Å‡∏©‡πå")

# ==========================================
# ‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì (Processing)
# ==========================================
# 1. ‡∏ó‡∏µ‡πà‡∏î‡∏¥‡∏ô
total_land_price = total_wah_calc * land_price_per_wah

# 2. ‡∏™‡∏¥‡πà‡∏á‡∏õ‡∏•‡∏π‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á
age = calc_year_th - build_year_th
dep_percent = calculate_depreciation(build_type, age)
full_build_price = build_area * build_price_sqm
dep_amount = full_build_price * (dep_percent / 100)
net_build_price = full_build_price - dep_amount

# 3. ‡∏£‡∏ß‡∏°
grand_total = total_land_price + net_build_price

# ==========================================
# TAB 3: ‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•
# ==========================================
with tab3:
    st.header("‡∏ö‡∏ó‡∏™‡∏£‡∏∏‡∏õ‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô")
    
    # ‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡πÉ‡∏´‡∏ç‡πà‡πÜ (Hero Section)
    st.markdown(f"""
    <div style="background-color: #d4edda; padding: 20px; border-radius: 15px; text-align: center; border: 2px solid #c3e6cb;">
        <h3 style="margin:0; color: #155724;">‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏¥‡πâ‡∏ô</h3>
        <h1 style="margin:10px 0; color: #155724; font-size: 42px;">{grand_total:,.2f} ‡∏ö‡∏≤‡∏ó</h1>
    </div>
    <br>
    """, unsafe_allow_html=True)

    # ‡∏Å‡∏£‡∏≤‡∏ü‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô (Bar Chart)
    chart_data = pd.DataFrame({
        '‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£': ['‡∏ó‡∏µ‡πà‡∏î‡∏¥‡∏ô', '‡∏™‡∏¥‡πà‡∏á‡∏õ‡∏•‡∏π‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á (‡∏™‡∏∏‡∏ó‡∏ò‡∏¥)'],
        '‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤ (‡∏ö‡∏≤‡∏ó)': [total_land_price, net_build_price]
    })
    st.bar_chart(chart_data, x='‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£', y='‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤ (‡∏ö‡∏≤‡∏ó)', color=["#FF9800"])

    # ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÅ‡∏ö‡∏ö‡πÄ‡∏à‡∏≤‡∏∞‡∏•‡∏∂‡∏Å
    st.markdown("### üìÑ ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì")
    
    # ‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏Ñ‡πà‡∏≤‡πÄ‡∏™‡∏∑‡πà‡∏≠‡∏°‡πÅ‡∏ö‡∏ö Progress bar
    st.write(f"**‡∏™‡∏†‡∏≤‡∏û‡∏™‡∏¥‡πà‡∏á‡∏õ‡∏•‡∏π‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á:** ‡∏≠‡∏≤‡∏¢‡∏∏ {age} ‡∏õ‡∏µ (‡∏´‡∏±‡∏Å‡∏Ñ‡πà‡∏≤‡πÄ‡∏™‡∏∑‡πà‡∏≠‡∏° {dep_percent}%)")
    st.progress(dep_percent / 100) # ‡πÅ‡∏™‡∏î‡∏á‡πÅ‡∏ñ‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Å‡πà‡∏≤‡∏Ç‡∏≠‡∏á‡∏ï‡∏∂‡∏Å
    
    # ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏™‡∏£‡∏∏‡∏õ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç (DataFrame)
    summary_data = {
        "‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£": ["1. ‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏î‡∏¥‡∏ô", "2. ‡∏™‡∏¥‡πà‡∏á‡∏õ‡∏•‡∏π‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á (‡∏ï‡∏±‡πâ‡∏á‡∏ï‡πâ‡∏ô)", "3. ‡∏´‡∏±‡∏Å‡∏Ñ‡πà‡∏≤‡πÄ‡∏™‡∏∑‡πà‡∏≠‡∏°‡∏£‡∏≤‡∏Ñ‡∏≤", "4. ‡∏™‡∏¥‡πà‡∏á‡∏õ‡∏•‡∏π‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á (‡∏™‡∏∏‡∏ó‡∏ò‡∏¥)"],
        "‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î": [
            f"{total_wah_calc:,.1f} ‡∏ï‡∏£.‡∏ß. x {land_price_per_wah:,.0f} ‡∏ö.",
            f"{build_area:,.0f} ‡∏ï‡∏£.‡∏°. x {build_price_sqm:,.0f} ‡∏ö.",
            f"‡∏´‡∏±‡∏Å {dep_percent}% (‡∏≠‡∏≤‡∏¢‡∏∏ {age} ‡∏õ‡∏µ)",
            "‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏´‡∏•‡∏±‡∏á‡∏´‡∏±‡∏Å‡∏Ñ‡πà‡∏≤‡πÄ‡∏™‡∏∑‡πà‡∏≠‡∏°"
        ],
        "‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô (‡∏ö‡∏≤‡∏ó)": [
            total_land_price,
            full_build_price,
            -dep_amount,  # ‡πÉ‡∏™‡πà‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢‡∏•‡∏ö
            net_build_price
        ]
    }
    df = pd.DataFrame(summary_data)
    st.table(df) # ‡πÉ‡∏ä‡πâ st.table ‡∏à‡∏∞‡∏î‡∏π clean ‡∏Å‡∏ß‡πà‡∏≤ dataframe ‡πÉ‡∏ô‡∏Å‡∏£‡∏ì‡∏µ‡∏ô‡∏µ‡πâ

    # ‡∏õ‡∏∏‡πà‡∏°‡∏Ñ‡∏≥‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
    st.warning("‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏Å‡∏≤‡∏£‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏à‡∏£‡∏¥‡∏á‡∏≠‡∏≤‡∏à‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡∏ï‡∏≤‡∏°‡∏î‡∏∏‡∏•‡∏¢‡∏û‡∏¥‡∏ô‡∏¥‡∏à‡∏Ç‡∏≠‡∏á‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏Å‡∏£‡∏°‡∏ó‡∏µ‡πà‡∏î‡∏¥‡∏ô")

# --- Footer ---
st.markdown("---")
st.markdown("<div style='text-align: center; color: grey;'>‡∏û‡∏±‡∏í‡∏ô‡∏≤‡πÇ‡∏î‡∏¢ Streamlit Python</div>", unsafe_allow_html=True)
