import streamlit as st
import datetime

# --- 1. ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö (GUI Setup) ---
st.set_page_config(
    page_title="‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ó‡∏µ‡πà‡∏î‡∏¥‡∏ô (‡∏Å‡∏£‡∏°‡∏ó‡∏µ‡πà‡∏î‡∏¥‡∏ô)",
    page_icon="üè†",
    layout="wide" # ‡∏õ‡∏£‡∏±‡∏ö‡πÉ‡∏´‡πâ‡πÄ‡∏ï‡πá‡∏°‡∏à‡∏≠
)

# ‡πÅ‡∏ï‡πà‡∏á‡∏™‡∏ß‡∏¢‡∏á‡∏≤‡∏°‡∏î‡πâ‡∏ß‡∏¢ CSS (‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏ï‡∏±‡∏ß‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡πÉ‡∏´‡∏ç‡πà ‡∏≠‡πà‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢)
st.markdown("""
<style>
    .big-font { font-size:20px !important; font-weight: bold; }
    .result-box { background-color: #f0f2f6; padding: 20px; border-radius: 10px; }
</style>
""", unsafe_allow_html=True)

# --- 2. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì (Logic: ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏™‡∏∑‡πà‡∏≠‡∏° ‡∏û.‡∏®. 2535) ---
def calculate_depreciation(build_type, age):
    if age < 1: age = 1
    dep_percent = 0
    
    # ‡∏ï‡∏£‡∏£‡∏Å‡∏∞‡πÅ‡∏ö‡∏ö‡∏Ç‡∏±‡πâ‡∏ô‡∏ö‡∏±‡∏ô‡πÑ‡∏î (Step Ladder Logic)
    if build_type == '‡∏ï‡∏∂‡∏Å (Concrete)':
        # 1-10 ‡∏õ‡∏µ: 1%, 11-42 ‡∏õ‡∏µ: 2%
        if age <= 10:
            dep_percent = age * 1
        else:
            dep_percent = 10 + (age - 10) * 2
        if dep_percent > 76: dep_percent = 76

    elif build_type == '‡∏Ñ‡∏£‡∏∂‡πà‡∏á‡∏ï‡∏∂‡∏Å‡∏Ñ‡∏£‡∏∂‡πà‡∏á‡πÑ‡∏°‡πâ (Half)':
        # 1-5 ‡∏õ‡∏µ: 2%, 6-15 ‡∏õ‡∏µ: 4%, 16+ ‡∏õ‡∏µ: 5%
        if age <= 5:
            dep_percent = age * 2
        elif age <= 15:
            dep_percent = 10 + (age - 5) * 4
        else:
            dep_percent = 10 + 40 + (age - 15) * 5
        if dep_percent > 85: dep_percent = 85

    elif build_type == '‡πÑ‡∏°‡πâ (Wood)':
        # 1-5 ‡∏õ‡∏µ: 3%, 6-15 ‡∏õ‡∏µ: 5%, 16+ ‡∏õ‡∏µ: 7%
        if age <= 5:
            dep_percent = age * 3
        elif age <= 15:
            dep_percent = 15 + (age - 5) * 5
        else:
            dep_percent = 15 + 50 + (age - 15) * 7
        if dep_percent > 93: dep_percent = 93
        
    return dep_percent

# --- 3. ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡∏≤‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏° (User Interface) ---
st.title("üè† ‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏£‡∏≤‡∏Ñ‡∏≤‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏ó‡∏∏‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏ó‡∏µ‡πà‡∏î‡∏¥‡∏ô‡πÅ‡∏•‡∏∞‡∏™‡∏¥‡πà‡∏á‡∏õ‡∏•‡∏π‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á")
st.info("‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á: ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Ñ‡πà‡∏≤‡πÄ‡∏™‡∏∑‡πà‡∏≠‡∏°‡∏£‡∏≤‡∏Ñ‡∏≤‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏∑‡∏≠‡∏ô‡∏™‡∏¥‡πà‡∏á‡∏õ‡∏•‡∏π‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á ‡∏û.‡∏®. 2535 (‡πÅ‡∏ö‡∏ö‡∏Ç‡∏±‡πâ‡∏ô‡∏ö‡∏±‡∏ô‡πÑ‡∏î)")

st.markdown("---")

# ‡πÅ‡∏ö‡πà‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡πÄ‡∏õ‡πá‡∏ô 2 ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå (‡∏ã‡πâ‡∏≤‡∏¢: ‡∏ó‡∏µ‡πà‡∏î‡∏¥‡∏ô, ‡∏Ç‡∏ß‡∏≤: ‡∏™‡∏¥‡πà‡∏á‡∏õ‡∏•‡∏π‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á)
col_land, col_build = st.columns(2)

# === ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏ã‡πâ‡∏≤‡∏¢: ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏î‡∏¥‡∏ô ===
with col_land:
    st.header("1. ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏î‡∏¥‡∏ô (Land)")
    
    c1, c2, c3 = st.columns(3)
    with c1: land_rai = st.number_input("‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÑ‡∏£‡πà", min_value=0, value=0)
    with c2: land_ngan = st.number_input("‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏á‡∏≤‡∏ô", min_value=0, value=0)
    with c3: land_wah = st.number_input("‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ß‡∏≤", min_value=0.0, value=17.0, step=0.1)
    
    st.markdown("##### ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏ï‡πà‡∏≠‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ß‡∏≤")
    land_price_per_wah = st.number_input("‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏≤‡∏Ñ‡∏≤ (‡∏ö‡∏≤‡∏ó)", min_value=0.0, value=24000.0, step=100.0)

# === ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏Ç‡∏ß‡∏≤: ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏¥‡πà‡∏á‡∏õ‡∏•‡∏π‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á ===
with col_build:
    st.header("2. ‡∏™‡πà‡∏ß‡∏ô‡∏™‡∏¥‡πà‡∏á‡∏õ‡∏•‡∏π‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á (Building)")
    
    build_type = st.selectbox("‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏™‡∏¥‡πà‡∏á‡∏õ‡∏•‡∏π‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á", 
                              ['‡∏ï‡∏∂‡∏Å (Concrete)', '‡∏Ñ‡∏£‡∏∂‡πà‡∏á‡∏ï‡∏∂‡∏Å‡∏Ñ‡∏£‡∏∂‡πà‡∏á‡πÑ‡∏°‡πâ (Half)', '‡πÑ‡∏°‡πâ (Wood)'])
    
    # ‡∏î‡∏∂‡∏á‡∏õ‡∏µ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
    current_year_sys = datetime.datetime.now().year + 543
    
    cb1, cb2 = st.columns(2)
    with cb1: 
        build_year_th = st.number_input("‡∏õ‡∏µ‡∏õ‡∏•‡∏π‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á (‡∏û.‡∏®.)", min_value=2400, max_value=current_year_sys, value=2553)
    with cb2: 
        calc_year_th = st.number_input("‡∏õ‡∏µ‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô (‡∏û.‡∏®.)", min_value=2400, value=2565)
    
    cb3, cb4 = st.columns(2)
    with cb3: 
        build_area = st.number_input("‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏™‡∏≠‡∏¢ (‡∏ï‡∏£.‡∏°.)", min_value=0.0, value=120.0)
    with cb4: 
        build_price_sqm = st.number_input("‡∏£‡∏≤‡∏Ñ‡∏≤‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô (‡∏ö‡∏≤‡∏ó/‡∏ï‡∏£.‡∏°.)", min_value=0.0, value=10400.0)

# --- 4. ‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏• (Processing) ---
# ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ó‡∏µ‡πà‡∏î‡∏¥‡∏ô
total_land_wah = (land_rai * 400) + (land_ngan * 100) + land_wah
total_land_price = total_land_wah * land_price_per_wah

# ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏™‡∏¥‡πà‡∏á‡∏õ‡∏•‡∏π‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á
age = calc_year_th - build_year_th
dep_percent = calculate_depreciation(build_type, age) # ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Ç‡πâ‡∏≤‡∏á‡∏ö‡∏ô
full_build_price = build_area * build_price_sqm
dep_amount = full_build_price * (dep_percent / 100)
net_build_price = full_build_price - dep_amount

# ‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏¥‡πâ‡∏ô
grand_total = total_land_price + net_build_price

# --- 5. ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå (Output Display) ---
st.markdown("---")
st.subheader("üìä ‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏£‡∏≤‡∏Ñ‡∏≤")

# ‡πÅ‡∏™‡∏î‡∏á‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå 3 ‡∏Å‡∏•‡πà‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏Å‡∏±‡∏ô
m1, m2, m3 = st.columns(3)

m1.success(f"üìç ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ó‡∏µ‡πà‡∏î‡∏¥‡∏ô‡∏£‡∏ß‡∏°\n\n### {total_land_price:,.2f} ‡∏ö‡∏≤‡∏ó")
m2.info(f"üèöÔ∏è ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏™‡∏¥‡πà‡∏á‡∏õ‡∏•‡∏π‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á (‡∏™‡∏∏‡∏ó‡∏ò‡∏¥)\n\n### {net_build_price:,.2f} ‡∏ö‡∏≤‡∏ó")
m3.error(f"üí∞ ‡∏£‡∏ß‡∏°‡∏£‡∏≤‡∏Ñ‡∏≤‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏¥‡πâ‡∏ô\n\n### {grand_total:,.2f} ‡∏ö‡∏≤‡∏ó")

# ‡∏™‡πà‡∏ß‡∏ô‡∏Ç‡∏¢‡∏≤‡∏¢‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î
with st.expander("‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î"):
    st.markdown(f"""
    **1. ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏ó‡∏µ‡πà‡∏î‡∏¥‡∏ô**
    - ‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏ó‡∏µ‡πà‡∏£‡∏ß‡∏°: {land_rai} ‡πÑ‡∏£‡πà {land_ngan} ‡∏á‡∏≤‡∏ô {land_wah} ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ß‡∏≤ ({total_land_wah:,.1f} ‡∏ï‡∏£.‡∏ß.)
    - ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô: {land_price_per_wah:,.2f} ‡∏ö‡∏≤‡∏ó/‡∏ï‡∏£.‡∏ß.
    
    **2. ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏™‡∏¥‡πà‡∏á‡∏õ‡∏•‡∏π‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á**
    - ‡∏≠‡∏≤‡∏¢‡∏∏‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£: **{age} ‡∏õ‡∏µ** (‡∏™‡∏£‡πâ‡∏≤‡∏á {build_year_th} - ‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô {calc_year_th})
    - ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó: {build_type}
    - ‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Ñ‡πà‡∏≤‡πÄ‡∏™‡∏∑‡πà‡∏≠‡∏°‡∏£‡∏≤‡∏Ñ‡∏≤: **{dep_percent}%** (‡∏ï‡∏≤‡∏°‡∏ï‡∏≤‡∏£‡∏≤‡∏á ‡∏û.‡∏®. 2535)
    - ‡∏£‡∏≤‡∏Ñ‡∏≤‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏∑‡∏≠‡∏ô‡πÄ‡∏ï‡πá‡∏°: {full_build_price:,.2f} ‡∏ö‡∏≤‡∏ó
    - ‡∏´‡∏±‡∏Å‡∏Ñ‡πà‡∏≤‡πÄ‡∏™‡∏∑‡πà‡∏≠‡∏°‡∏£‡∏≤‡∏Ñ‡∏≤: -{dep_amount:,.2f} ‡∏ö‡∏≤‡∏ó
    """)